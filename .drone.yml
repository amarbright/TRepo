---
pipeline:
  build:
    when:
      event:
      - push
      - pull_request
    image: maven:3-jdk-8
    commands:
    - mvn -B clean package
    - java -jar /drone/src/github.target.com/amarbright/TRepo/target/automation-0.0.1-SNAPSHOT.jar
  publish:
    artifactory:
    url: http://localhost:8081/artifactory
    username: admin
    password: asiya123 
    pom: pom.xml 
    repo_key: automation_local_maven
    files: 
      - target/*.jar
      - target/*.war
  notify:
    image: plugins/slack
    webhook: https://hooks.slack.com/services/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
    channel: automation
    username: drone
    template: >
      {{#success build.status}}
      Hey Amar, build {{build.number}} succeed & moved to Repo...
      {{else}}
      Hey Amar, build {{build.number}} Failed, fix me...
      {{/success}}
